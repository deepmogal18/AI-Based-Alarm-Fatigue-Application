<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Clinical Alarm Analysis</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
    #analysis-card.loading { filter: blur(4px); opacity: 0.6; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <main class="w-full max-w-4xl bg-white rounded-2xl shadow-lg p-6 md:p-8">
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-gray-800">AI-Powered Clinical Alarm Analysis</h1>
      <p class="text-gray-500 mt-1">Simulate patient vitals and get instant AI-driven severity analysis.</p>
    </header>

  
    <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
      <label for="apiUrl" class="block text-sm font-medium text-gray-700">Backend API URL</label>
      <div class="mt-1 flex items-center space-x-3">
        <input type="text" id="apiUrl" class="flex-grow px-3 py-2 border rounded-md shadow-sm" placeholder="Paste your API URL here...">
        <button id="connectBtn" class="px-5 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Connect</button>
      </div>
      <div id="status" class="mt-2 text-sm font-medium text-red-600">Status: Disconnected</div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    
      <div id="vitals-panel" class="opacity-50 pointer-events-none">
        <h2 class="text-xl font-semibold mb-4">Patient Vitals</h2>
        <div class="space-y-6">
          <div><label>Heart Rate <span id="heart_rate_value" class="font-bold">90</span></label>
            <input id="heart_rate" type="range" min="40" max="180" value="90" class="w-full">
          </div>
          <div><label>Systolic BP <span id="systolic_bp_value" class="font-bold">120</span></label>
            <input id="systolic_bp" type="range" min="70" max="200" value="120" class="w-full">
          </div>
          <div><label>SpO2 <span id="spo2_value" class="font-bold">98</span></label>
            <input id="spo2" type="range" min="80" max="100" value="98" class="w-full">
          </div>
          <div><label>Respiration <span id="respiration_rate_value" class="font-bold">16</span></label>
            <input id="respiration_rate" type="range" min="8" max="40" value="16" class="w-full">
          </div>
          <div><label>Temperature <span id="temperature_value" class="font-bold">37.0</span></label>
            <input id="temperature" type="range" min="35" max="41" step="0.1" value="37.0" class="w-full">
          </div>
        </div>
        <button id="triggerBtn" class="mt-6 w-full py-3 bg-green-600 text-white rounded-lg disabled:bg-gray-400" disabled>Trigger Alarm Analysis</button>
      </div>

     
      <div class="relative">
        <div id="analysis-spinner" class="absolute inset-0 bg-white/70 flex items-center justify-center rounded-lg hidden">
          <div class="animate-spin h-10 w-10 border-4 border-blue-600 border-t-transparent rounded-full"></div>
        </div>
        <div id="analysis-card" class="bg-gray-50 border rounded-lg p-6 h-full text-center">
          <h2 class="text-xl font-semibold mb-4">AI Analysis</h2>
          <p class="text-sm text-gray-500">Severity</p>
          <p id="severity-text" class="text-4xl font-bold text-gray-800 my-2">--%</p>
          <p class="text-sm text-gray-500">Model Confidence</p>
          <p id="accuracy-text" class="text-2xl font-semibold text-gray-700">--%</p>
          <p class="text-sm text-gray-500 mt-4">AI Overview</p>
          <p id="overview-text" class="text-base font-medium italic">Connect to backend to begin...</p>
        </div>
      </div>
    </div>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const apiUrlInput = document.getElementById('apiUrl');
  const connectBtn = document.getElementById('connectBtn');
  const statusDiv = document.getElementById('status');
  const vitalsPanel = document.getElementById('vitals-panel');
  const triggerBtn = document.getElementById('triggerBtn');
  const analysisCard = document.getElementById('analysis-card');
  const spinner = document.getElementById('analysis-spinner');
  const severityText = document.getElementById('severity-text');
  const accuracyText = document.getElementById('accuracy-text');
  const overviewText = document.getElementById('overview-text');

  let backendUrl = '';

  
  connectBtn.addEventListener('click', () => {
    const url = apiUrlInput.value.trim();
    if (url) {
      backendUrl = url;
      statusDiv.textContent = 'Status: Connected';
      statusDiv.classList.replace('text-red-600','text-green-600');
      vitalsPanel.classList.remove('opacity-50','pointer-events-none');
      triggerBtn.disabled = false;
    }
  });

  
  const sliders = ['heart_rate','systolic_bp','spo2','respiration_rate','temperature'];
  sliders.forEach(id => {
    const el = document.getElementById(id);
    const val = document.getElementById(id + '_value');
    el.addEventListener('input', () => {
      val.textContent = id==='temperature' ? parseFloat(el.value).toFixed(1) : el.value;
    });
  });

  triggerBtn.addEventListener('click', async () => {
    if (!backendUrl) return alert('Connect backend first');

    const data = {
      heart_rate: parseInt(document.getElementById('heart_rate').value),
      systolic_bp: parseInt(document.getElementById('systolic_bp').value),
      spo2: parseInt(document.getElementById('spo2').value),
      respiration_rate: parseInt(document.getElementById('respiration_rate').value),
      temperature: parseFloat(document.getElementById('temperature').value)
    };

   
    const message = `Patient vitals: 
    - Heart Rate: ${data.heart_rate} bpm
    - Systolic BP: ${data.systolic_bp} mmHg
    - SpO2: ${data.spo2} %
    - Respiration: ${data.respiration_rate} breaths/min
    - Temperature: ${data.temperature} Â°C
    Provide severity percentage, confidence, and overview.`;

    setLoading(true);

    try {
      const response = await fetch(`${backendUrl}/chat`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ message })
      });
      const result = await response.json();

      if (!response.ok) throw new Error(result.error || 'Server error');

    
      const text = result.response;
      const severity = (text.match(/(\d+)% severity/)||[])[1] || 50;
      const accuracy = (text.match(/(\d+)% confidence/)||[])[1] || 70;

      severityText.textContent = severity+'%';
      accuracyText.textContent = accuracy+'%';
      overviewText.textContent = text;
    } catch (e) {
      overviewText.textContent = 'Error: '+e.message;
    } finally {
      setLoading(false);
    }
  });

  function setLoading(x){
    if(x){ spinner.classList.remove('hidden'); analysisCard.classList.add('loading'); }
    else{ spinner.classList.add('hidden'); analysisCard.classList.remove('loading'); }
  }
});
</script>
</body>
</html>
